<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
    <link rel="stylesheet" href="authentication.css">
    <script src="https://kit.fontawesome.com/dd61417c3c.js" crossorigin="anonymous"></script>
    <script src="https://smtpjs.com/v3/smtp.js"></script>
    <title>ADMIN | REGISTER</title>
</head>
<body id="register">
    <div class="vh-100 d-flex flex-nowrap justify-content-center align-items-center">
        <div class="h-75 shadow-lg border rounded-5">
            <div class="h-25 border rounded-4 text-center d-flex flex-nowrap justify-content-center align-items-center">
                <h4 class="text-white text-decoration-underline">REGISTRATION</h4>
            </div>
            <div class="mx-4 bg-white">
                <div class="mb-4 bg-white">
                    <h3 class="bg-white">Username <span class="text-danger bg-white">*</span></h3>
                    <input id="userName" class="fs-3 px-2 rounded-3 bg-white" type="text">
                    <i id="warningIconUsername" class="fa-solid"></i><span id="exist" class="fs-5 bg-transparent"></span>
                </div>
                <div class="mb-5 bg-white">
                    <h3 class="bg-white">Email <span class="text-danger bg-white">*</span></h3>
                    <input id="email" class="fs-3 px-2 rounded-3 bg-white" type="text">
                </div>
                <div class="mb-5 bg-white">
                    <h3 id="passH3" class="bg-white">Password <span class="text-danger bg-white">*</span></h3>
                    <input id="password" class="fs-3 px-2 rounded-3 bg-white" type="password">
                </div>
                <div class="mb-5 bg-white">
                    <h3 id="cPassH3" class="bg-white">Confirm Password <span class="text-danger bg-transparent">*</span></h3>
                    <input id="cPassword" class="fs-3 px-2 rounded-3 bg-white" type="password">
                    <i id="warningIconPassword" class="fa-solid"></i><span id="wrongPass" class="fs-5 bg-transparent">.</span>
                </div>
                <div class="text-center bg-transparent">
                    <button id="regBtn" class="rounded-3" onclick="register()" disabled>REGISTER</button>
                </div>
                <div class="mt-4 bg-white">
                    <a id="loginBtn" class="d-flex flex-nowrap justify-content-center align-items-center text-decoration-none w-100 rounded-3" href="login.html" type="button">
                        LOG IN
                    </a>
                </div>
            </div>
        </div>
    </div>

<script>
    const regBtn = document.getElementById('regBtn');
    const userName = document.getElementById('userName');
    const email = document.getElementById('email');
    const password = document.getElementById('password');
    const cPassword = document.getElementById('cPassword');
    const wrongPassword = document.getElementById('wrongPass');

    function checkFields() {
        const userNameValue = userName.value.trim();
        const emailValue = email.value.trim();
        const passwordValue = password.value.trim();
        const cPasswordValue = cPassword.value.trim();
        const wrongPassword = document.getElementById('wrongPass').innerHTML;

        if (userNameValue !== '' && emailValue !== '' && passwordValue !== '' && cPasswordValue !== '' && wrongPassword == '.') {
            regBtn.disabled = false;
            regBtn.style.cursor = 'pointer'
            regBtn.style.backgroundColor = '#24315c';
            regBtn.style.color = 'white';
            cPassword.style.boxShadow = '0px';
        } else {
            regBtn.disabled = true;
            regBtn.style.cursor = 'not-allowed'
            regBtn.style.backgroundColor = '#7f8fc0';
            regBtn.style.color = 'rgb(231, 231, 231)';
        }
    }

    userName.addEventListener('keyup', checkFields);
    email.addEventListener('keyup', checkFields);
    password.addEventListener('keyup', checkFields);
    cPassword.addEventListener('keyup', checkFields);

    function checkPassword() {
        const regBtn = document.getElementById('regBtn');
        const password = document.getElementById('password');
        const cPassword = document.getElementById('cPassword');
        const wrongPassword = document.getElementById('wrongPass');
        const passH3 = document.getElementById('passH3');
        const cPassH3 = document.getElementById('cPassH3');
        const warningIconPassword = document.getElementById('warningIconPassword');
        
        if (password.value !== '' && cPassword.value !== '') {
            if (password.value === cPassword.value) {
                wrongPassword.style.color = "white"
                wrongPassword.innerHTML = "."
                password.style.border = "2px solid rgb(168, 168, 168)"
                cPassword.style.border = "2px solid rgb(168, 168, 168)"
                passH3.style.color = '#1b46d4'
                cPassH3.style.color = '#1b46d4'
                regBtn.disabled = false;
                regBtn.style.backgroundColor = '#24315c';
                regBtn.style.color = 'white';
                warningIconPassword.style.color = 'white'
                password.removeAttribute('style');
                cPassword.removeAttribute('style');
                regBtn.style.cursor = 'pointer'
            } else {
                wrongPassword.style.color = "black"
                wrongPassword.innerHTML = " " + "Incorrect Password"
                password.style.border = "2px solid red"
                cPassword.style.border = "2px solid red"
                passH3.style.color = 'red'
                cPassH3.style.color = 'red'
                regBtn.disabled = true;
                regBtn.style.backgroundColor = '#7f8fc0';
                regBtn.style.color = 'rgb(231, 231, 231)';
                cPassword.style.boxShadow = 'red 0px 0px 10px 0px';
                password.style.boxShadow = 'red 0px 0px 10px 0px';
                warningIconPassword.removeAttribute('style')
                warningIconPassword.classList.add('fa-triangle-exclamation');
                regBtn.style.cursor = 'not-allowed'
            }
        } else {
            wrongPassword.style.color = "black"
            wrongPassword.innerHTML = " " + "Incorrect Password"
            password.style.border = "2px solid red"
            cPassword.style.border = "2px solid red"
            passH3.style.color = 'red'
            cPassH3.style.color = 'red'
            regBtn.disabled = true;
            regBtn.style.backgroundColor = '#7f8fc0';
            regBtn.style.color = 'rgb(231, 231, 231)';
            cPassword.style.boxShadow = 'red 0px 0px 10px 0px';
            password.style.boxShadow = 'red 0px 0px 10px 0px';
            warningIconPassword.removeAttribute('style')
            warningIconPassword.classList.add('fa-triangle-exclamation');
            regBtn.style.cursor = 'not-allowed'
        }
    }

    password.addEventListener('keyup' , checkPassword)
    cPassword.addEventListener('keyup' , checkPassword)

    function validatePass() {
        const regBtn = document.getElementById('regBtn');
        const password = document.getElementById('password');
        const cPassword = document.getElementById('cPassword');
        const wrongPassword = document.getElementById('wrongPass');
        const passH3 = document.getElementById('passH3');
        const cPassH3 = document.getElementById('cPassH3');
        const warningIconPassword = document.getElementById('warningIconPassword');

        if (cPassword.value !== '' && password.value !== '') {
            if (password.value === cPassword.value) {
                wrongPassword.style.color = "white"
                wrongPassword.innerHTML = "."
                password.style.border = "2px solid rgb(168, 168, 168)"
                cPassword.style.border = "2px solid rgb(168, 168, 168)"
                passH3.style.color = '#1b46d4'
                cPassH3.style.color = '#1b46d4'
                regBtn.disabled = false;
                regBtn.style.backgroundColor = '#24315c';
                regBtn.style.color = 'white';
                warningIconPassword.style.color = 'white'
                password.removeAttribute('style');
                cPassword.removeAttribute('style');
                regBtn.style.cursor = 'pointer'
            } else {
                wrongPassword.style.color = "black"
                wrongPassword.innerHTML = " " + "Incorrect Password"
                password.style.border = "2px solid red"
                cPassword.style.border = "2px solid red"
                passH3.style.color = 'red'
                cPassH3.style.color = 'red'
                regBtn.disabled = true;
                regBtn.style.backgroundColor = '#7f8fc0';
                regBtn.style.color = 'rgb(231, 231, 231)';
                cPassword.style.boxShadow = 'red 0px 0px 10px 0px';
                password.style.boxShadow = 'red 0px 0px 10px 0px';
                warningIconPassword.removeAttribute('style')
                warningIconPassword.classList.add('fa-triangle-exclamation');
                regBtn.style.cursor = 'not-allowed'
            }
        } else {
            wrongPassword.style.color = "black"
            wrongPassword.innerHTML = " " + "Incorrect Password"
            password.style.border = "2px solid red"
            cPassword.style.border = "2px solid red"
            passH3.style.color = 'red'
            cPassH3.style.color = 'red'
            regBtn.disabled = true;
            regBtn.style.backgroundColor = '#7f8fc0';
            regBtn.style.color = 'rgb(231, 231, 231)';
            cPassword.style.boxShadow = 'red 0px 0px 10px 0px';
            password.style.boxShadow = 'red 0px 0px 10px 0px';
            warningIconPassword.removeAttribute('style')
            warningIconPassword.classList.add('fa-triangle-exclamation');
            regBtn.style.cursor = 'not-allowed'
        }
    }
        
    password.addEventListener('keyup' , validatePass) 

    function register() {
        fetch('http://localhost:3000/register', {
            method: 'post',
            headers: {
                'Accept': 'application/json',
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({
                username: userName.value,
                email: email.value,
                password: password.value,
            })
        }).then((data) => {
            return data.json()
        }).then((data) => {
            const warningIconUsername = document.getElementById('warningIconUsername');
            const exist = document.getElementById('exist');

            if (data.success) {
                regBtn.innerHTML = '✔️'
                regBtn.style.width = '15%'
                regBtn.style.boxShadow = 'green 0px 0px 10px 0px'
            } else {
                userName.style.boxShadow = 'red 0px 0px 10px 0px';
                userName.style.border = "2px solid red"
                userName.style.animation = 'shake1 0.5s'
                warningIconUsername.removeAttribute('style');
                warningIconUsername.classList.add('fa-triangle-exclamation');
                exist.style.color = "black"
                exist.innerHTML = " " + "Username Already Taken"
                setTimeout(() => {
                    userName.style.removeProperty('animation')
                }, 500);
            }
        })
    }
</script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL" crossorigin="anonymous"></script>
</body>
</html>